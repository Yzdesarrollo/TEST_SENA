@page "/RegistroUsuario"
@inject IUserServices UserServices
@inject IRolServices RolServices
@inject NavigationManager nav
@inject IJSRuntime JS


<h3>Registrar Nuevo Usuario</h3>

<EditForm Model="@user" OnValidSubmit="@CrearUser">
    <DataAnnotationsValidator />
    @*  <ValidationSummary />*@
    <div class="row">
        <div class="col-md-4">
            <div class="form-group">
                <label for="name" class="col-form-label">Nombre Usuario:</label>
                <InputText id="name" @bind-Value="@user.Name" class="form-control" />
                <ValidationMessage For="@(() => user.Name)" />
            </div>
            <div class="form-group">
                <label for="surname" class="col-form-label">Apellido:</label>
                <InputText id="surname" @bind-Value="@user.Surname" class="form-control" />
                <ValidationMessage For="@(() => user.Surname)" />
            </div>
            <div class="form-group">
                <label for="documentType" class="col-form-label">Tipo de Documento:</label>
                <InputText id="documentType" @bind-Value="@user.DocumentType" class="form-control" />
                <ValidationMessage For="@(() => user.DocumentType)" />
            </div>
            <div class="form-group">
                <label for="document" class="col-form-label"> Documento:</label>
                <InputText id="document" @bind-Value="@user.Document" class="form-control" />
                <ValidationMessage For="@(() => user.Document)" />
            </div>
            <div class="form-group">
                <label for="address" class="col-form-label">Direccion:</label>
                <InputText id="address" @bind-Value="@user.Address" class="form-control" />
                <ValidationMessage For="@(() => user.Address)" />
            </div>

            <div class="form-group">
                <label class="col-form-label">Rol:</label>
                @* <InputSelect @bind-Value="user.Rol" ValueChanged="" ValueExpression="" Value="">*@
                <InputSelect @bind-Value="user.RolId" class="form-control">

                    @foreach (var rol in ListadoRoles)
                    {
                        if (rol.Id == 0 || rol.Name == string.Empty)
                        {
                            <option value=@rol.Id>Seleccione Rol</option>
                        }
                        else
                        {
                            <option value=@rol.Id>@rol.Name</option>
                        }

                    }
                </InputSelect>
            </div>
            <div class="form-group">
                <label class="col-form-label">Estado: </label>
                <InputCheckbox @bind-Value="@user.Status"></InputCheckbox>
                <ValidationMessage For="@(() => user.Status)" />
            </div>
            <div class="form-group" row>
                <button type="submit" class="btn btn-success">Guardar</button>
                <NavLink class="btn btn-primary" href="ListadoUsuarios" style="text-decoration:none;">Regresar</NavLink>
            </div>
        </div>
    </div>
</EditForm>

@code {

    User user = new User();
    List<Rol> ListadoRoles = new List<Rol>();


    protected override async Task OnInitializedAsync()
    {

        ListadoRoles = await RolServices.GetAllRoles();
    }

    async Task CrearUser()
    {
        var response = await UserServices.CreateUser(user);
        nav.NavigateTo("ListadoUsuarios");

    }

}